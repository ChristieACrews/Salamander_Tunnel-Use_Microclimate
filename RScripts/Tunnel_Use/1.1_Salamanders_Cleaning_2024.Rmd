---
title: "1.1 Salamander Capture Data Cleaning - 2024"
author: "Christie Crews"
date: "`r Sys.Date()`"
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "HTML_reports") })
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Version of R used: `r getRversion()`
<br> 

### Project

There but geriatric? A resurvey of salamander road mitigation infrastructure in Waterton Lakes National Park 15 years after installation reveals limited use by a small number of aged salamanders

<br> 
<br>

### Overview

<br>

#### **Goal(s):**

This script explores my data from 2024 and prepares it for merging with an older data set (2013/2014). This is the first script in the pipeline.

<br>

#### **Details about files and pipeline:** 
<br>

1) File information  

The input file for this script is the dataset collected by myself and field assistant, A. Smith, in Spring 2024. The original file is "Individual_Capture_Data_20240526.xls".  I used **Excel** to delete the row of instructions for data entry, modify data entry errors, add a column called "TravelDirection", and convert the spreadsheet into a csv, "Individual_Capture_Data_2024_Fixed.csv". The specific data modified follows:

* Row 2, (CaptureID LL-240422-001), changed SVL_mm to NA from 64 as measurement protocol changed with subsequent captures. HeadWidth_mm was changed to NA from 41 as this is a clear measurement error; no LTSA would have a 41 mm head width.

* Row 3, (CaptureID LL-20240422-002), changed Mass_g to NA from 51 as this is a clear measurement error; no LTSA would have a 51 g mass.

* Row 10, (CaptureID LL-20240427-009), Sex_Stage was changed to Adult_Female from Adult_Male. This was a data entry error as the data sheet states a sex of female and notes state "gravid"

* Row 6, (CaptureID LL-20240426-005), OlderRecapture changed to Yes from unclear as I feel very confident she is from 2013/2014




<br>

2) File contents 


<blockquote style="font-size: 100%;">


Columns in the input file: 

1)	Site: Unique site ID (categorical)

2)	SamplingDay: The number in sequence for the sampling event as sampling events cross midnight

3)	Date: Date of the capture 

4)	TimeBinary: Morning or night capture (categorical)

5)	Time: Time of the capture

6)	CaptureType: Type of capture (categorical)

7)	TrapID: The ID of the trap a salamander was capture in, if applicable (categorical). Traps are identified by a 3 character code designating tunnel number (1-4, starting at the northernmost tunnel), side of road (East or West), and trap number (1 or 2)

8)	CoverObjectID: The ID of the cover object a salamander was captured under, if applicable (categorical). Cover objects were numbered starting with 1 for the object

9)	NearestTunnel: The nearest tunnel to the capture location (categorical)

10)	TravelDirection: The presumed direction of travel based on the trap or behaviour observations (categorical)

11)	Lat_dd: Latitude of captures not at a trap

12)	Long_dd: Longitude of captures not at a trap

13)	SubstrateTemp_CaptureLocation_C: Substrate temperature recorded at the capture location

14)	SubstrateTemp_Control_C: Substrate temperature recorded at a control location

15)	Moisture_Capture: Substrate moisture measurement recorded at the capture location

16)	Moisture_Control: Substrate moisture measurement recorded

17)	HabitatType: The habitat type at a capture location at a control location

18)	SubstrateNotes: Any additional substrate notes

19)	CaptureID: The unique ID number assigned to the capture event (text)

20)	IndividualID: The unique ID number assigned to an individual (text)

21)	Recapture: Whether the individual was previously captured in the current study (categorical)

22)	Sex_Stage: The sex and ife stage of a captured individual

23)	SVL_mm: The snout-vent length measured to the posterior end of the vent (numeric)

24)	HeadWidth_mm: The width between the eyes of an individual (numeric)

25)	Mass_g: The mass of an individual to .01 g (numeric)

26)	TissueSample: Whether a tissue sample (tail clip) was obtained (categorical)

27)	OlderRecapture: Whether the individual was initially captured by previous study in 2013/2014 (categorical)

28)	PhotoNumbers: The numbers of photos taken of the individual (text)

29)	Observers: Names of people who conducted the survey (text)

30)	Notes: Any additional notes (text)

</blockquote> 

<br>
<br>

### Setting up the R environment
<br>

#### Working directory: 

```{r, message =FALSE}
# setwd("/Users/fabfa/OneDrive/Documents/0 - Frogs/Natural History Note/NatHisNote_DataAnalysis")
```
  
<br>  

#### Libraries: 

```{r, message=FALSE}

# load libraries
library(tidyr)
library(tidyverse)
library(dplyr)
library(janitor)
library(lubridate)
```
  
<br>  

<br>

### Data and Analysis 


#### Load and explore my data

1. Load the data: 

```{r}
#load my data from 2024
all_captures_2024 <- read.csv("data_raw/Individual_Capture_Data_2024_fixed.csv")

```

2. Check number of rows and columns is as expected:

```{r}
dim(all_captures_2024)
```


```{r}
all_captures_2024 <- all_captures_2024 %>%
  remove_empty(whic=c("cols")) %>% #remove empty columns
  remove_empty(whic=c("rows")) #remove empty rows
```

```{r}
dim(all_captures_2024)
```

<br>

3. Get information about the data class for each column: 

```{r}
str(all_captures_2024)
summary(all_captures_2024)
```
*We can see that we need to adjust the data classes of several columns to make them easier to work with:*

```{r}
#Turn the Date column into a date data class
all_captures_2024$Date <- as.Date(all_captures_2024$Date)


#make several columns into factors
all_captures_2024 <- all_captures_2024 %>% 
  mutate_at(c('TimeBinary', 'CaptureType', 'TrapID', 'CoverObjectID', 'NearestTunnel', 'Recapture', 'Sex_Stage', 'OlderRecapture'), as.factor)

#Make several columns into numbers
all_captures_2024 <- all_captures_2024 %>% 
  mutate_at(c('SVL_mm', 'HeadWidth_mm', 'Mass_g'), as.numeric)
```

4. Remove unusable columns
``` {r}
#remove extra columns that can't be used for data analysis like notes, observers, etc
all_captures_2024 <- all_captures_2024 %>% 
  select(-Notes)
```

```{r}
str(all_captures_2024)
summary(all_captures_2024)
```

*Looks like the expected number of rows and columns. All values appear normal with no obvious measurement or data entry errors present.*

<br>

#### Final Output

``` {r}
#create csv for the combined data
write.csv(all_captures_2024, "data/All_Captures_2024.csv", row.names=FALSE)

```


### Conclusions 

Only minimal data wrangling was required as my data set is quite small. This script primarily explored the data to ensure everything was as expected and ready for analysis.

The next step is to clean my 2025 data.

<br>
<br> 

### Specific notes for the manuscript/thesis 

None

<br>
<br> 

### References 

None

